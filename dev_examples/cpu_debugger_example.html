<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url(https://themes.googleusercontent.com/fonts/css?kit=MXVwpSGzOOhqOc5hUWJbBLizfYjsfH9XaeDpmRKYJN5bV0WvE1cEyAoIq5yYZlSc);ol.lst-kix_d0z6v0lynmrm-1{list-style-type:none}.lst-kix_d0z6v0lynmrm-8>li:before{content:"" counter(lst-ctn-kix_d0z6v0lynmrm-8,lower-roman) ". "}ol.lst-kix_d0z6v0lynmrm-0{list-style-type:none}ol.lst-kix_d0z6v0lynmrm-5{list-style-type:none}.lst-kix_d0z6v0lynmrm-6>li:before{content:"" counter(lst-ctn-kix_d0z6v0lynmrm-6,decimal) ". "}ol.lst-kix_d0z6v0lynmrm-4{list-style-type:none}ol.lst-kix_d0z6v0lynmrm-3{list-style-type:none}.lst-kix_d0z6v0lynmrm-5>li:before{content:"" counter(lst-ctn-kix_d0z6v0lynmrm-5,lower-roman) ". "}ol.lst-kix_d0z6v0lynmrm-5.start{counter-reset:lst-ctn-kix_d0z6v0lynmrm-5 0}ol.lst-kix_d0z6v0lynmrm-2{list-style-type:none}ol.lst-kix_d0z6v0lynmrm-0.start{counter-reset:lst-ctn-kix_d0z6v0lynmrm-0 0}ol.lst-kix_d0z6v0lynmrm-3.start{counter-reset:lst-ctn-kix_d0z6v0lynmrm-3 0}.lst-kix_d0z6v0lynmrm-4>li:before{content:"" counter(lst-ctn-kix_d0z6v0lynmrm-4,lower-latin) ". "}ol.lst-kix_d0z6v0lynmrm-8{list-style-type:none}ol.lst-kix_d0z6v0lynmrm-7{list-style-type:none}ol.lst-kix_d0z6v0lynmrm-6{list-style-type:none}.lst-kix_d0z6v0lynmrm-1>li{counter-increment:lst-ctn-kix_d0z6v0lynmrm-1}.lst-kix_d0z6v0lynmrm-4>li{counter-increment:lst-ctn-kix_d0z6v0lynmrm-4}.lst-kix_d0z6v0lynmrm-3>li:before{content:"" counter(lst-ctn-kix_d0z6v0lynmrm-3,decimal) ". "}ol.lst-kix_d0z6v0lynmrm-8.start{counter-reset:lst-ctn-kix_d0z6v0lynmrm-8 0}.lst-kix_d0z6v0lynmrm-0>li:before{content:"" counter(lst-ctn-kix_d0z6v0lynmrm-0,decimal) ". "}ol.lst-kix_d0z6v0lynmrm-1.start{counter-reset:lst-ctn-kix_d0z6v0lynmrm-1 0}.lst-kix_d0z6v0lynmrm-2>li:before{content:"" counter(lst-ctn-kix_d0z6v0lynmrm-2,lower-roman) ". "}.lst-kix_d0z6v0lynmrm-1>li:before{content:"" counter(lst-ctn-kix_d0z6v0lynmrm-1,lower-latin) ". "}.lst-kix_d0z6v0lynmrm-7>li{counter-increment:lst-ctn-kix_d0z6v0lynmrm-7}ol.lst-kix_d0z6v0lynmrm-6.start{counter-reset:lst-ctn-kix_d0z6v0lynmrm-6 0}.lst-kix_d0z6v0lynmrm-0>li{counter-increment:lst-ctn-kix_d0z6v0lynmrm-0}.lst-kix_d0z6v0lynmrm-3>li{counter-increment:lst-ctn-kix_d0z6v0lynmrm-3}.lst-kix_d0z6v0lynmrm-6>li{counter-increment:lst-ctn-kix_d0z6v0lynmrm-6}ol.lst-kix_d0z6v0lynmrm-4.start{counter-reset:lst-ctn-kix_d0z6v0lynmrm-4 0}ol.lst-kix_d0z6v0lynmrm-2.start{counter-reset:lst-ctn-kix_d0z6v0lynmrm-2 0}ol.lst-kix_d0z6v0lynmrm-7.start{counter-reset:lst-ctn-kix_d0z6v0lynmrm-7 0}.lst-kix_d0z6v0lynmrm-2>li{counter-increment:lst-ctn-kix_d0z6v0lynmrm-2}.lst-kix_d0z6v0lynmrm-8>li{counter-increment:lst-ctn-kix_d0z6v0lynmrm-8}.lst-kix_d0z6v0lynmrm-5>li{counter-increment:lst-ctn-kix_d0z6v0lynmrm-5}.lst-kix_d0z6v0lynmrm-7>li:before{content:"" counter(lst-ctn-kix_d0z6v0lynmrm-7,lower-latin) ". "}ol{margin:0;padding:0}table td,table th{padding:0}.c3{color:#666666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:9pt;font-family:"Roboto Mono";font-style:normal}.c1{color:#e06666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:9pt;font-family:"Roboto Mono";font-style:normal}.c7{-webkit-text-decoration-skip:none;color:#45818e;text-decoration:underline;vertical-align:baseline;text-decoration-skip-ink:none;font-style:normal}.c5{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c2{font-size:9pt;font-family:"Roboto Mono";color:#9900ff;font-weight:400}.c0{font-size:9pt;font-family:"Roboto Mono";color:#f1c232;font-weight:400}.c10{-webkit-text-decoration-skip:none;color:#45818e;text-decoration:underline;text-decoration-skip-ink:none}.c11{color:#4a86e8;font-weight:700;font-size:9pt;font-family:"Roboto Mono"}.c6{-webkit-text-decoration-skip:none;color:#4a86e8;text-decoration:underline;text-decoration-skip-ink:none}.c13{font-weight:400;font-size:11pt;font-family:"Roboto Mono"}.c8{text-decoration:none;vertical-align:baseline;font-style:normal}.c14{background-color:#ffffff;max-width:756pt;padding:10.8pt 18pt 10.8pt 18pt}.c4{font-size:9pt;font-weight:400;font-family:"Roboto Mono"}.c12{color:#666666}.c9{color:#000000}.c15{color:#e06666}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c14 doc-content"><p class="c5"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11 c8">TEST_BFlag:</span></p><p class="c5"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">;;; Test 1 [The B Flag]: The &quot;B flag&quot; is set in the value pushed to the stack by PHP ;;;</span></p><p class="c5"><span class="c4">D924</span><span class="c4">&nbsp; </span><span class="c2">08 &nbsp; &nbsp; &nbsp;</span><span class="c8 c4 c9">&nbsp; PHP</span></p><p class="c5"><span class="c4">D925</span><span class="c4">&nbsp; </span><span class="c2">68 &nbsp; &nbsp; &nbsp;</span><span class="c8 c4 c9">&nbsp; PLA</span></p><p class="c5"><span class="c4">D926</span><span class="c4">&nbsp; </span><span class="c2">85 50 &nbsp; </span><span class="c4">&nbsp; STA </span><span class="c0">$50 </span><span class="c4 c12">; we&#39;ll get back to this one.</span></p><p class="c5"><span class="c4">D928</span><span class="c4">&nbsp; </span><span class="c2">29 10 &nbsp; </span><span class="c4">&nbsp; AND </span><span class="c4 c15">#$10</span></p><p class="c5"><span class="c4">D92A</span><span class="c4">&nbsp; </span><span class="c2">F0 F0 &nbsp; </span><span class="c4">&nbsp; BEQ </span><span class="c6 c4">FAIL_BFlag</span></p><p class="c5"><span class="c4">D92C</span><span class="c4">&nbsp; </span><span class="c2">E6 10 &nbsp; </span><span class="c4">&nbsp; INC </span><span class="c7 c4">ErrorCode</span></p><p class="c5"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">;;; Test 2 [The B Flag]: The &quot;B flag&quot; is set in the value pushed to the stack by BRK ;;;</span></p><p class="c5"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Set up the BRK routine</span></p><p class="c5"><span class="c4">D92E</span><span class="c4">&nbsp; </span><span class="c2">A9 4C &nbsp; </span><span class="c4">&nbsp; LDA </span><span class="c1">#$4C</span></p><p class="c5"><span class="c4">D930</span><span class="c4">&nbsp; </span><span class="c2">8D 00 06</span><span class="c4">&nbsp; STA </span><span class="c0 c8">$0600</span></p><p class="c5"><span class="c4">D933</span><span class="c4">&nbsp; </span><span class="c2">8D 00 07</span><span class="c4">&nbsp; STA </span><span class="c0">$0700</span><span class="c4">&nbsp; &nbsp;</span><span class="c3">; also set this up now for the NMI test.</span></p><p class="c5"><span class="c4">D936</span><span class="c4">&nbsp; </span><span class="c2">A9 41</span><span class="c4">&nbsp; &nbsp; &nbsp;LDA </span><span class="c10 c4">LOW(TEST_BFlag_BRK)</span></p><p class="c5"><span class="c4">D938</span><span class="c4">&nbsp; </span><span class="c2">8D 01 06</span><span class="c4">&nbsp; STA </span><span class="c0 c8">$0601</span></p><p class="c5"><span class="c4">D93B</span><span class="c4">&nbsp; </span><span class="c2">A9 D9</span><span class="c4">&nbsp; &nbsp; &nbsp;LDA </span><span class="c4 c10">HIGH(TEST_BFlag_BRK)</span></p><p class="c5"><span class="c4">D93D</span><span class="c4">&nbsp; </span><span class="c2">8D 02 06</span><span class="c4">&nbsp; STA </span><span class="c0 c8">$0602</span></p><p class="c5"><span class="c4">D940</span><span class="c4">&nbsp; </span><span class="c2">00</span><span class="c8 c4 c9">&nbsp; &nbsp; &nbsp; &nbsp; BRK</span></p><p class="c5"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c8 c11">TEST_BFlag_BRK:</span></p><p class="c5"><span class="c4">D941 &nbsp;</span><span class="c2">68</span><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; PLA </span><span class="c3">; pull off processor flags.</span></p><p class="c5"><span class="c4">D942 &nbsp;</span><span class="c2">85 51</span><span class="c4">&nbsp; &nbsp; &nbsp;STA </span><span class="c0">$51</span><span class="c4">&nbsp;</span><span class="c3">; we&rsquo;ll get back to this one.</span></p><p class="c5"><span class="c4">D944 &nbsp;</span><span class="c2">68</span><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; PLA </span><span class="c3">; pull off the return address</span></p><p class="c5"><span class="c4">D945 &nbsp;</span><span class="c2">68</span><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; PLA </span><span class="c3">; ^</span></p><p class="c5"><span class="c4">D946 &nbsp;</span><span class="c2">A5 51</span><span class="c4">&nbsp; &nbsp; &nbsp;LDA </span><span class="c0 c8">$51</span></p><p class="c5"><span class="c4">D948 &nbsp;</span><span class="c2">29 10</span><span class="c4">&nbsp; &nbsp; &nbsp;AND </span><span class="c1">#$10</span></p><p class="c5"><span class="c4">D94A &nbsp;</span><span class="c2">F0 D0</span><span class="c4">&nbsp; &nbsp; &nbsp;BEQ </span><span class="c6 c4">FAIL_BFlag</span><span class="c3">&nbsp; ; the B flag should be set.</span></p><p class="c5"><span class="c4">D94C &nbsp;</span><span class="c2">E6 10</span><span class="c4">&nbsp; &nbsp; &nbsp;INC </span><span class="c7 c4">ErrorCode</span></p><p class="c5"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;</span><span class="c3">;; Test 3 [The B Flag]: This emulator should be capable of running an IRQ before I run an IRQ test. ;;;</span></p><p class="c5"><span class="c4">D94E &nbsp;</span><span class="c2">A9 69</span><span class="c4">&nbsp; &nbsp; &nbsp;LDA </span><span class="c7 c4">HIGH(TEST_BFlag_BRK)</span></p><p class="c5"><span class="c4">D950 &nbsp;</span><span class="c2">8D 01 06</span><span class="c4">&nbsp; STA </span><span class="c0 c8">$0601</span></p><p class="c5"><span class="c4">D953 &nbsp;</span><span class="c2">A9 D9</span><span class="c4">&nbsp; &nbsp; &nbsp;LDA </span><span class="c4 c7">HIGH(TEST_BFlag_BRK2)</span></p><p class="c5"><span class="c4">D955 &nbsp;</span><span class="c2">8D 02 06</span><span class="c4">&nbsp; STA </span><span class="c0 c8">$0602</span></p><p class="c5"><span class="c4">D958 &nbsp;</span><span class="c2">78</span><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; SEI </span><span class="c3">; Set the interrupt flag to make sure the IRQ does not happen yet.</span></p><p class="c5"><span class="c4">D959 &nbsp;</span><span class="c2">A9 00</span><span class="c4">&nbsp; &nbsp; &nbsp;LDA </span><span class="c1">#$00</span></p><p class="c5"><span class="c4">D95B &nbsp;</span><span class="c2">8D 17 40</span><span class="c4">&nbsp; STA </span><span class="c0">$4017</span><span class="c3">&nbsp; &nbsp;; Set up the APU Frame Counter so an IRQ occurs in approximately 30,000 CPU cycles.</span></p><p class="c5"><span class="c4">D95E &nbsp;</span><span class="c2">20 18 FC</span><span class="c4">&nbsp; JSR </span><span class="c6 c4">Clockslide_30000</span><span class="c3">&nbsp; &nbsp; ; stall for 30,000 CPU cycles.</span></p><p class="c5"><span class="c4">D961 &nbsp;</span><span class="c2">58</span><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; CLI</span><span class="c3">&nbsp;; Clear the interrupt flag, triggering the IRQ (after the first NOP. See [Interrupt Polling])</span></p><p class="c5"><span class="c4">D962 &nbsp;</span><span class="c2">EA</span><span class="c8 c4 c9">&nbsp; &nbsp; &nbsp; &nbsp; NOP</span></p><p class="c5"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">; The IRQ occurs here.</span></p><p class="c5"><span class="c4">D963 &nbsp;</span><span class="c2">EA</span><span class="c8 c4 c9">&nbsp; &nbsp; &nbsp; &nbsp; NOP</span></p><p class="c5"><span class="c4">D964 &nbsp;</span><span class="c2">EA</span><span class="c8 c4 c9">&nbsp; &nbsp; &nbsp; &nbsp; NOP</span></p><p class="c5"><span class="c4">D965 &nbsp;</span><span class="c2">78</span><span class="c8 c4 c9">&nbsp; &nbsp; &nbsp; &nbsp; SEI</span></p><p class="c5"><span class="c4">D966 &nbsp;</span><span class="c2">4C 38 A0</span><span class="c4">&nbsp; JMP </span><span class="c4 c6">TEST_Fail</span></p></body></html>